#!/usr/bin/env bash

if [[ -n $TMUX ]]; then
    tmux choose-session
    exit 0
fi

sessions=$(tmux list-sessions -F '#{session_name}' 2>/dev/null)

if [[ -z $sessions ]]; then
    echo "No active tmux sessions."
    exit 0
fi

bell_sessions=$(tmux list-windows -a -F '#{session_name} #{window_bell_flag}' 2>/dev/null | awk '$2 == "1" {print $1}' | sort -u)
bell_list="" list=""
while IFS= read -r name; do
    if echo "$bell_sessions" | grep -qx "$name"; then
        bell_list+="$name 󰂞"$'\n'
    else
        list+="$name"$'\n'
    fi
done <<< "$sessions"

selected=$(printf '%s%s' "$bell_list" "$list" | sed '/^$/d' | fzf --no-sort)

if [[ -z $selected ]]; then
    exit 0
fi

selected="${selected% 󰂞}"
tmux attach-session -t "$selected"
